{
  "code" : "-- SUPABASE SCHEMA FIX: Align with HDM's expectations\n-- Run this in Supabase SQL Editor: https:\/\/supabase.com\/dashboard\/project\/qnnpjhlxljtqyigedwkb\/sql\n\n-- 1. Fix autonomous_logs table\nALTER TABLE autonomous_logs \n  ADD COLUMN IF NOT EXISTS repid_tag TEXT DEFAULT 'REPORTED',\n  ADD COLUMN IF NOT EXISTS verified_by TEXT[] DEFAULT '{}';\n\n-- Verify columns exist\nSELECT column_name, data_type \nFROM information_schema.columns \nWHERE table_name = 'autonomous_logs'\nORDER BY ordinal_position;\n\n-- 2. Fix agent_status table  \nALTER TABLE agent_status\n  ADD COLUMN IF NOT EXISTS current_task TEXT,\n  ADD COLUMN IF NOT EXISTS performance_metrics JSONB DEFAULT '{}';\n\n-- Verify columns exist\nSELECT column_name, data_type\nFROM information_schema.columns\nWHERE table_name = 'agent_status'\nORDER BY ordinal_position;\n\n-- 3. Verify trinity_tasks has all required columns\nALTER TABLE trinity_tasks\n  ADD COLUMN IF NOT EXISTS task_type TEXT DEFAULT 'trinity',\n  ADD COLUMN IF NOT EXISTS empathy_score FLOAT DEFAULT NULL,\n  ADD COLUMN IF NOT EXISTS completed_at TIMESTAMP DEFAULT NULL;\n\nSELECT column_name, data_type\nFROM information_schema.columns\nWHERE table_name = 'trinity_tasks'\nORDER BY ordinal_position;\n\n-- 4. Create agent_coordination table if missing\nCREATE TABLE IF NOT EXISTS agent_coordination (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  from_agent TEXT NOT NULL,\n  to_agent TEXT NOT NULL,\n  message_type TEXT NOT NULL,\n  content JSONB NOT NULL,\n  sent_at TIMESTAMP DEFAULT NOW(),\n  acknowledged_at TIMESTAMP DEFAULT NULL\n);\n\n-- 5. Create learning_patterns table if missing (for MEL)\nCREATE TABLE IF NOT EXISTS learning_patterns (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  pattern_type TEXT NOT NULL,\n  description TEXT,\n  frequency INTEGER DEFAULT 1,\n  confidence FLOAT DEFAULT 0.5,\n  discovered_by TEXT DEFAULT 'MEL',\n  first_seen TIMESTAMP DEFAULT NOW(),\n  last_seen TIMESTAMP DEFAULT NOW(),\n  metadata JSONB DEFAULT '{}'\n);\n\n-- 6. Grant permissions (if needed)\nGRANT ALL ON autonomous_logs TO authenticated, anon;\nGRANT ALL ON agent_status TO authenticated, anon;\nGRANT ALL ON trinity_tasks TO authenticated, anon;\nGRANT ALL ON agent_coordination TO authenticated, anon;\nGRANT ALL ON learning_patterns TO authenticated, anon;\n\n-- SUCCESS! Your HDM heartbeat\/status updates should now work.\n",
  "filename" : "\/mnt\/user-data\/outputs\/fix_hdm_schema_alignment.sql",
  "language" : "sql"